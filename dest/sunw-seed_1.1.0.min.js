!function(a,b,c,d){c=a[c]=a[c]?a[c]:function(a){return/^#/.test(a)?b.getElementById(a.replace(/^#+/,"")):/^\./.test(a)?b.getElementsByClassName(a.replace(/^\.+/,"")):b.getElementsByTagName(a)};var e="1.1",f={ERROR_PARAM_TYPE:"param type is unsupported",ERROR_PARAM_NOT_EXISTS:"param [ ? ] does not exist",ERROR_MODULE_BLANK:"module name is blank",ERROR_MODULE_EXISTS:"module [ ? ] exists",ERROR_MODULE_NOT_EXISTS:"module [ ? ] does not exist",ERROR_MODULE_TIMEOUT:"module [ ? ] loaded timeout",ERROR_MODULE_LOAD_FAILED:"module [ ? ] load failed",ERROR_NODE_NOT_INIT:"node [ ? ] is not initialized",ERROR_NODE_LOAD_FAILED:"node [ ? ] load failed"},g={UNLOAD:0,ERROR:1,TIMEOUT:2,LOADING:3,SUCCESS:4},h=function(){var a=b.getElementsByTagName("script"),c=a[a.length-1];return c.src.replace(/\?.*$/,"").replace(/\/[^\/]+\/*$/,"/")}(),i=!1,j=!1,k=[],l=function(){var b=!1,c=1,d=0,e=function(b){return b&&"object"==typeof b&&b!=a&&!b.nodeType};for("boolean"==typeof arguments[0]&&(b=arguments[0],c=2,d=1);c<arguments.length;c++)for(var f in arguments[c])b&&e(arguments[d][f])&&e(arguments[c][f])?arguments[d][f]=l.call(a,b,arguments[d][f],arguments[c][f]):arguments[d][f]=arguments[c][f];return arguments[d]},m={_contactUri:function(){for(var a=arguments[0]||"",b=1,d=arguments.length;d>b;b++)if(!c.isBlank(arguments[b])){var e=/^\?/.test(arguments[b])?"":"/";a=a.replace(/\/$/,"")+e+arguments[b].replace(/^\//,"")}return a},getPath:function(a,b){if(c.isBlank(a)||/^\/|((http|https|ftp):\/\/)/.test(b))return b;for(;;)if(/^(\.\/)+/.test(b))b=b.replace(/^(\.\/)+/,"");else{if(!/^\.\.\//.test(b))return m._contactUri(a,b);b=b.replace(/^\.\.\//,""),a=a.replace(/\/[^\/]+\/*$/,"/")}},getLoadingModules:function(a){for(var b=[],d={},e=(function(a){var b=c.getModuleDependencies(a);a in d||(d[a]=c.getModule(a,!0)._module);for(var f=0,g=b.length;g>f;f++)e(b[f]);return d[a]}),f=0,g=a.length;g>f;f++)e(a[f]);for(var h in d)b.push(d[h]);return b},error:function(a,b){throw a.replace("?",b)},toArray:function(a){return c.isString(a)?c.isBlank(a)?[]:c.trim(a).split(/\s*,\s*/):c.isArray(a)?a:m.error(f.ERROR_PARAM_TYPE)}};l(c,{version:e,base:h,defaults:{base:"",timeout:1e4,async:!0,charset:"",version:""},State:g,Env:c.Env||{modules:{},State:{}}}),l(c,{extend:l,bind:function(a,d,e){return b.addEventListener?a.addEventListener(d,e,!1):a.attachEvent("on"+d,e),c},isString:function(a){return"string"==typeof a},isPlainObject:function(b){return"object"==typeof b&&b!=a&&!b.nodeType},isBoolean:function(a){return"boolean"==typeof a},isBlank:function(a){return null==a||this.isString(a)&&0==this.trim(a).length},isArray:function(a){return Array.isArray(a)},isFunction:function(a){return"function"==typeof a},trim:function(a){return this.isString(a)?a.replace("^\\s*|\\s*$",""):m.error(f.ERROR_PARAM_TYPE)}}),l(c,{getModule:function(a,b){var d;return c.isString(a)?(d=c.Env.modules[c.trim(a)],b!==!0||d?d:m.error(f.ERROR_MODULE_NOT_EXISTS,a)):m.error(f.ERROR_PARAM_TYPE)},getModuleDependencies:function(a){var b=c.getModule(a,!0);return b.dependencies},getModuleState:function(a){c.getModule(a,!0);return c.Env.State[c.trim(a)]}}),l(c,{ready:function(b){var c=this;return j||c._bindReady(),i?b.call(a,c):k.push(b),c},_bindReady:function(){function c(){b.removeEventListener(g,c,!1),i()}function d(){b.readyState===h&&b.detachEvent(g,d)}var e=this,f=b.documentElement.doScroll,g=f?"onreadystatechange":"DOMContentLoaded",h="complete",i=function(){e._fireReady()};return j=!0,b.readyState===h?i():void(b.addEventListener?(b.addEventListener(g,c,!1),a.addEventListener("load",i,!1)):(b.attachEvent(g,d),a.attachEvent("onload",i),a===a.top&&!function k(){try{f("left"),i()}catch(a){setTimeout(k,1)}}()))},_fireReady:function(){if(!i){i=!0;for(var b=0,c=k.length;c>b;b++)k[b].call(a,this);k=[]}}}),l(c,{add:function(a,b,e){var i,j="";if(e==d&&(e=b,b=[]),b=m.toArray(b),c.isString(e)&&(e=m.toArray(e)),!c.isPlainObject(a)&&!c.isString(a)||!c.isFunction(e)&&!c.isArray(e))return m.error(f.ERROR_PARAM_TYPE);if(c.isString(a))a=c.trim(a),i=l(!0,{},c.defaults);else{if(!("name"in a))return m.error(f.ERROR_PARAM_NOT_EXISTS,"name");i=l(!0,{},c.defaults,a),a=c.trim(a.name),delete i.name}if(j=m.getPath(h,i.base),c.isArray(e))for(var k=0,n=e.length;n>k;k++){if(c.isString(e[k]))e[k]={url:e[k]};else{if(!c.isPlainObject(e[k]))return m.error(f.ERROR_PARAM_TYPE);if(!("url"in e[k]))return m.error(f.ERROR_PARAM_NOT_EXISTS,"url")}e[k].url=m.getPath(j,e[k].url),e[k]=l(!0,{},i,e[k]),delete e[k].timeout,delete e[k].base}return c.Env.modules[a]?m.error(f.ERROR_MODULE_EXISTS,a):(delete i.async,delete i.charset,delete i.url,c.Env.modules[a]={config:i,dependencies:b,factory:e},c.Env.modules[a]._module=new o(a),c.Env.State[a]=g.UNLOAD,c)},use:function(b,d){for(var b=m.toArray(b),e=function(){var e=[c],f=0,h=0;for(f=0,h=b.length;h>f;f++)if(c.getModuleState(b[f])!==g.SUCCESS)return!1;for(f=0,h=b.length;h>f;f++)e.push(c.getModule(b[f],!0).result);c.isFunction(d)&&d.apply(a,e)},f=0,h=b.length;h>f;f++)c.getModule(b[f])._module.load(e);return c}});var n=function(a){var b=this;l(b,a,{state:g.UNLOAD,callback:d,autoLoad:!1,_dom:d,_subscribers:[]}),b._init()};l(n.prototype,{_init:function(){var a=this,d=c.isBlank(a.version)?a.url:a.url+(a.url.indexOf("?")<0?"?":"&")+"v="+a.version,e=/\.css\??.*$/i.test(a.url),f=function(b,c){c.isFunction(a.callback)&&a.callback.call(a,b,c)},h=function(){for(var b=0,c=a._subscribers.length;c>b;b++)a._subscribers[b].load.call(a._subscribers[b],a.callback)},i=function(){a.state=g.SUCCESS,f(!0,c),h()},j=function(){a.state=g.ERROR,f(!1,c),h()};l(!0,a,{_url:d,_callback:f,_success:i,_error:j,_isCss:e}),a._isCss?(a._dom=b.createElement("link"),l(a._dom,{rel:"stylesheet",href:d,type:"text/css"})):(a._dom=b.createElement("script"),l(a._dom,{src:d,type:"text/javascript"}),c.isBoolean(a.async)&&(a._dom.async=a.async)),c.isBlank(a.charset)||(a._dom.charset=a.charset),c.bind(a._dom,"load",i).bind(a._dom,"error",j)},addSubscribers:function(a){var b=this,d=function(a){a instanceof n&&(b._subscribers.push(a),a.autoLoad=!0)};if(c.isArray(a))for(var e=0,f=a.length;f>e;e++)d(a[e]);else d(a);return b},canLoad:function(){var a=this,c=a._isCss?"link":"script",d=a._isCss?"href":"src",e=b.getElementsByTagName(c);if(e&&e.length>0)for(var f=0,g=e.length;g>f;f++)if(a._url==e[f][d])return!1;return!0},load:function(a){var c=this;return c._dom?c.canLoad()===!1?c._success:(c.state=g.LOADING,c.callback=a,(b.head||b).appendChild(c._dom),void 0):m.error(f.ERROR_NODE_NOT_INIT,c.url)}});var o=function(a){var b=this;l(b,c.Env.modules[a].config,{name:a,callback:[],_result:d,_tid:d,_success:d,_error:d}),b._init()};l(o.prototype,{_init:function(){var a=this,b=a.name,d=c.Env.State;l(a,{_success:function(){a._tid&&clearTimeout(a._tid),d[b]=g.SUCCESS,a._callback(!0,c)},_error:function(){a._tid&&clearTimeout(a._tid),d[b]=g.ERROR,a._callback(!1,c)},_callback:function(b,c){for(;a.callback.length>0;)c.isFunction(a.callback[0])&&a.callback[0].call(a,b,c),a.callback.shift()},_addCallback:function(b){if(c.isFunction(b))a.callback.push(b);else if(c.isArray(b))for(var d=0,e=b.length;e>d;d++)c.isFunction(b[d])&&a.callback.push(b[d]);return a}})},canLoad:function(){for(var a=this,b=a.name,d=c.getModuleDependencies(b),e=0,f=d.length;f>e;e++)if(c.getModuleState(d[e])!==g.SUCCESS)return!1;return!0},load:function(a){var b=this,d=b.name,e=b.timeout,h=c.Env.State,i=c.Env.modules,j=i[d],k=j.dependencies,l=j.factory;if(h[d]===g.SUCCESS)return b._addCallback(a),b._callback(!0,c);if(h[d]===g.LOADING)return b._addCallback(a);var n={},o=function(){return b.canLoad()?(h[d]=g.LOADING,!isNaN(e)&&e>0&&(b._tid=setTimeout(function(){h[d]=g.TIMEOUT,b.callback=[],m.error(f.ERROR_MODULE_TIMEOUT,d)},e)),c.isFunction(l)?b._loadFn(a):b._loadNodes(a)):!1};if(k.length>0)for(var p=0,q=k.length;q>p;p++)k[p]in n||(n[k[p]]=!0,i[k[p]]._module.load(o));else o()},_loadFn:function(a){var b=this,d=b.name,e=c.getModule(d,!0),g=e.factory,h=e.dependencies;b._addCallback(a);for(var i=[c],j=0,k=h.length;k>j;j++)i.push(c.getModule(h[j],!0).result);try{e.result=g.apply(b,i),b._success()}catch(l){return b._error(),m.error(f.ERROR_MODULE_LOAD_FAILED,d)}},_loadNodes:function(a){var b=this,d=b.name,e=c.Env.modules,f=e[d],h=f.factory,i=[],j=function(){for(var a=!0,c=0,d=i.length;d>c;c++)if(i[c].state===g.ERROR)a=!1;else if(i[c].state!==g.SUCCESS)return!1;a?b._success():b._error()};b._addCallback(a);for(var k=0,l=h.length;l>k;k++)i.push(new n(h[k]));for(var k=0,l=i.length;l>k;k++)i[k].async===!1&&l-1>k&&i[k].addSubscribers(Array.prototype.slice.call(i,k+1)),i[k].autoLoad!==!0&&i[k].load(j)}})}(window,document,"Sunw");